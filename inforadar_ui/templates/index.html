{% extends "base.html" %}

{% block content %}
<div class="welcome-container">
  <h2 class="page-title fade-in">üèÜ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ OddlyOdds Production</h2>
  <p class="fade-in-delay">
    –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ ‚öôÔ∏è
  </p>

  <!-- ====== –ë–ª–æ–∫ –∏–∫–æ–Ω–æ–∫ ====== -->
  <div class="sports-icons fade-in-slow">
    <div class="icon-card">
      <img src="{{ url_for('static', filename='images/soccer.png') }}" alt="Soccer">
      <p>‚öΩ –§—É—Ç–±–æ–ª (Soccer)</p>
    </div>
    <div class="icon-card">
      <img src="{{ url_for('static', filename='images/basketball.png') }}" alt="Basketball">
      <p>üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª (NBA)</p>
    </div>
    <div class="icon-card">
      <img src="{{ url_for('static', filename='images/esports.png') }}" alt="Esports">
      <p>üéÆ –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç (Esports)</p>
    </div>
  </div>

  <!-- ====== –í–∫–ª–∞–¥–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ====== -->
  <div class="tabs fade-in-late">
    <button onclick="location.href='/live'" class="tab-btn">üî¥ Live</button>
    <button onclick="location.href='/prematch'" class="tab-btn">üïí Prematch</button>
    <button onclick="location.href='/matches'" class="tab-btn">üìä Matches</button>
    <button onclick="location.href='/esports'" class="tab-btn">üéÆ Esports</button>
    <button onclick="location.href='/anomalies'" class="tab-btn">‚ö† –ê–Ω–æ–º–∞–ª–∏–∏ (–ª–∏–º–∏—Ç—ã / —Å–Ω—è—Ç–∏—è)</button>
  </div>

  <!-- ====== –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í ====== -->
  <div class="filters-row fade-in-late">
    <div class="filter-group">
      <label for="sport-filter">üèÖ –í–∏–¥ —Å–ø–æ—Ä—Ç–∞</label>
      <select id="sport-filter">
        <option value="">–í—Å–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞</option>
        <option value="Football">Football</option>
        <option value="Basketball">Basketball</option>
        <option value="Tennis">Tennis</option>
        <option value="Hockey">Hockey</option>
        <option value="Volleyball">Volleyball</option>
        <option value="Handball">Handball</option>
        <option value="eSports">eSports</option>
        <option value="Futsal">Futsal</option>
      </select>
    </div>

    <!-- –ó–∞–≥–ª—É—à–∫–∞ –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä –ª–∏–≥–∏ (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
    <div class="filter-group">
      <label for="league-filter">üèÜ –õ–∏–≥–∞</label>
      <input id="league-filter" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Premier League">
    </div>

    <!-- –ß–∏–ø—ã —Ç–∏–ø–æ–≤ –º–∞—Ä–∫–µ—Ç–æ–≤ -->
    <div class="filter-group market-group">
      <label>üéØ –ú–∞—Ä–∫–µ—Ç</label>
      <div class="market-chips" id="market-chips">
        <button class="market-chip active" data-market="all">–í—Å–µ</button>
        <button class="market-chip" data-market="full_match">–ü–æ–ª–Ω—ã–π –º–∞—Ç—á</button>
        <button class="market-chip" data-market="time">üïí –¢–∞–π–º / –ø–µ—Ä–∏–æ–¥ / —Å–µ—Ç / –∫–∞—Ä—Ç–∞</button>
        <button class="market-chip" data-market="quarter">üü¶ –ß–µ—Ç–≤–µ—Ä—Ç—å</button>
        <button class="market-chip" data-market="totals">üìà –¢–æ—Ç–∞–ª—ã</button>
        <button class="market-chip" data-market="handicaps">‚ûñ –§–æ—Ä—ã</button>
        <button class="market-chip" data-market="exact_score">üéØ –¢–æ—á–Ω—ã–π —Å—á—ë—Ç</button>
        <button class="market-chip" data-market="goals_ou">‚öΩ –ì–æ–ª—ã O/U</button>
        <button class="market-chip" data-market="team_totals">üìä –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç–æ—Ç–∞–ª—ã</button>
      </div>
    </div>
  </div>

  <!-- ====== –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–ª–∏—Ü—ã —Å shimmer ====== -->
  <div id="matches-container" class="fade-in-late"></div>

  <!-- ====== –ò–Ω—Ñ–æ –±–ª–æ–∫ ====== -->
  <div class="welcome-panel fade-in-late">
    <p>
      –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ª–∏–Ω–∏–π –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞.
      –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ <b>10 —Å–µ–∫—É–Ω–¥</b> —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é üìà<br>
      –§–∏–ª—å—Ç—Ä—ã –ø–æ –ª–∏–º–∏—Ç–∞–º, —Å–Ω—è—Ç—ã–º –º–∞—Ç—á–∞–º –∏ –ø–æ—Ä–µ–∑–∫–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ
      <b>‚ö† –ê–Ω–æ–º–∞–ª–∏–∏</b>.
    </p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<style>
/* --- shimmer —ç—Ñ—Ñ–µ–∫—Ç --- */
.shimmer {
  position: relative;
  overflow: hidden;
  background: #f6f7f8;
  background-image: linear-gradient(
    to right,
    #f6f7f8 0%,
    #edeef1 20%,
    #f6f7f8 40%,
    #f6f7f8 100%
  );
  background-repeat: no-repeat;
  background-size: 800px 100%;
  animation: shimmer 1.5s linear infinite;
  border-radius: 8px;
}
@keyframes shimmer {
  0% { background-position: -800px 0; }
  100% { background-position: 800px 0; }
}
.shimmer-container { padding: 10px; }
.shimmer-line { height: 16px; margin-bottom: 8px; border-radius: 6px; }

/* —ç—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã */
.fade-in-table {
  animation: fadeIn 0.5s ease-in;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã */
#matches-container table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  background: #fff9ef;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 0 8px rgba(0,0,0,0.05);
}
#matches-container th, #matches-container td {
  padding: 8px 10px;
  text-align: center;
  border-bottom: 1px solid #f1e6c4;
}
#matches-container th {
  background: #ffe082;
  font-weight: 600;
}
#matches-container tr:hover {
  background: #fff3d1;
}

/* ===== –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ ===== */
.filters-row {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  align-items: flex-end;
  margin: 10px auto 5px;
  max-width: 1000px;
  justify-content: center;
}
.filter-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 160px;
}
.filter-group label {
  font-size: 13px;
  font-weight: 600;
  color: #6b542b;
}
.filter-group select,
.filter-group input {
  background: #fffdf5;
  border-radius: 8px;
  border: 1px solid #e2c474;
  padding: 6px 10px;
  font-size: 13px;
}

/* –ú–∞—Ä–∫–µ—Ç-—á–∏–ø—ã */
.market-group {
  flex: 1 1 100%;
}
.market-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.market-chip {
  border: none;
  border-radius: 999px;
  padding: 5px 10px;
  font-size: 12px;
  cursor: pointer;
  background: #fff7d6;
  color: #6b542b;
  transition: all 0.2s ease;
}
.market-chip:hover {
  background: #ffeaa6;
}
.market-chip.active {
  background: #ffb84d;
  color: #fff;
  box-shadow: 0 0 8px rgba(0,0,0,0.15);
}

/* responsive */
@media (max-width: 800px) {
  .filters-row {
    align-items: stretch;
  }
  .market-group {
    order: 3;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
  document.querySelectorAll(".fade-in, .fade-in-delay, .fade-in-slow, .fade-in-late")
    .forEach((el, i) => setTimeout(() => el.classList.add("visible"), 200 + i * 250));

  const sportSelect = document.getElementById("sport-filter");
  const leagueInput = document.getElementById("league-filter");
  const marketChips = document.getElementById("market-chips");

  let currentMarket = "all";

  // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ç-—á–∏–ø–æ–≤
  if (marketChips) {
    marketChips.addEventListener("click", (e) => {
      const btn = e.target.closest(".market-chip");
      if (!btn) return;
      currentMarket = btn.dataset.market || "all";
      marketChips.querySelectorAll(".market-chip").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      loadMatches();  // –≤ –±—É–¥—É—â–µ–º —Ñ–∏–ª—å—Ç—Ä –º–∞—Ä–∫–µ—Ç–æ–≤ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ odds/odds_history
    });
  }

  if (sportSelect) {
    sportSelect.addEventListener("change", () => loadMatches());
  }
  if (leagueInput) {
    leagueInput.addEventListener("change", () => loadMatches());
    leagueInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") loadMatches();
    });
  }

  // --- shimmer-–∞–Ω–∏–º–∞—Ü–∏—è ---
  function showShimmer() {
    const container = document.getElementById("matches-container");
    container.innerHTML = `
      <div class="shimmer-container">
        <div class="shimmer shimmer-line" style="width: 90%; height: 20px;"></div>
        <div class="shimmer shimmer-line" style="width: 75%; height: 20px;"></div>
        <div class="shimmer shimmer-line" style="width: 85%; height: 20px;"></div>
        <div class="shimmer shimmer-line" style="width: 60%; height: 20px;"></div>
      </div>
    `;
  }

  async function loadMatches() {
    showShimmer();

    const params = new URLSearchParams();

    const sportVal = sportSelect?.value || "";
    const leagueVal = leagueInput?.value || "";

    if (sportVal) params.set("sport", sportVal);
    if (leagueVal) params.set("league", leagueVal.trim());
    // currentMarket –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–ø–µ—Ä—ë–¥ ‚Äî –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å,
    // –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏–º API –ø–æ –º–∞—Ä–∫–µ—Ç–∞–º (odds / odds_history)
    if (currentMarket && currentMarket !== "all") {
      params.set("market_type", currentMarket);
    }

    const url = "/api/matches" + (params.toString() ? `?${params.toString()}` : "");

    try {
      const response = await fetch(url);
      const data = await response.json();
      setTimeout(() => renderTable(data), 300); // –ª—ë–≥–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
      const container = document.getElementById("matches-container");
      container.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</p>";
    }
  }

  function renderTable(matches) {
    const container = document.getElementById("matches-container");

    if (!matches || matches.length === 0) {
      container.innerHTML = "<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>";
      return;
    }

    let html = `
      <table class="fade-in-table">
        <thead>
          <tr>
            <th>–°–ø–æ—Ä—Ç</th>
            <th>–õ–∏–≥–∞</th>
            <th>–î–æ–º</th>
            <th>–ì–æ—Å—Ç–∏</th>
            <th>–°—á—ë—Ç</th>
            <th>–í—Ä–µ–º—è</th>
          </tr>
        </thead>
        <tbody>
    `;

    matches.forEach(m => {
      html += `
        <tr>
          <td>${m.sport}</td>
          <td>${m.league}</td>
          <td>${m.home_team}</td>
          <td>${m.away_team}</td>
          <td>${m.score_home ?? "-"} : ${m.score_away ?? "-"}</td>
          <td>${m.start_time}</td>
        </tr>
      `;
    });

    html += "</tbody></table>";
    container.innerHTML = html;
  }

  // --- –∑–∞–ø—É—Å–∫ shimmer + –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ ---
  loadMatches();
  setInterval(loadMatches, 10000);
});
</script>
{% endblock %}
