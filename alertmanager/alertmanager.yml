global:
  resolve_timeout: 5m

templates:
  - '/etc/alertmanager/templates/*.tmpl'

route:
  receiver: telegram_default

  group_wait: 10s
  group_interval: 1m
  repeat_interval: 3h

  group_by: ['alertname', 'instance']

  routes:
    # ========= âš  WARNING =========
    - match:
        severity: warning
      receiver: telegram_warning
      continue: false

    # ========= ğŸ”¥ CRITICAL =========
    - match:
        severity: critical
      receiver: telegram_critical
      continue: false

    # ========= ğŸŸ¦ FALLBACK =========
    - match_re:
        alertname: ".*"
      receiver: telegram_default
      continue: false

receivers:
  # =========== DEFAULT ===========
  - name: telegram_default
    telegram_configs:
      - bot_token: '8341243138:AAGu3-5VIBFHTxj5Uo8iXRe6Ee9I3m4genc'
        chat_id: 5377484616
        parse_mode: HTML
        message: |
          ğŸ“¢ <b>{{ .CommonLabels.alertname }}</b>
          ğŸ“¦ Instance: {{ .CommonLabels.instance }}
          ğŸ”¥ Status: {{ .Status }}
          ğŸ§¾ Summary: {{ .Annotations.summary }}

  # =========== WARNING ===========
  - name: telegram_warning
    telegram_configs:
      - bot_token: '8341243138:AAGu3-5VIBFHTxj5Uo8iXRe6Ee9I3m4genc'
        chat_id: 5377484616
        parse_mode: HTML
        message: |
          âš ï¸ <b>Warning Alert</b>
          ğŸ“¢ {{ .CommonLabels.alertname }}
          ğŸ§¾ {{ .Annotations.summary }}
          ğŸ“¦ Instance: {{ .CommonLabels.instance }}
          ğŸ” Status: {{ .Status }}

  # =========== CRITICAL ===========
  - name: telegram_critical
    telegram_configs:
      - bot_token: '8341243138:AAGu3-5VIBFHTxj5Uo8iXRe6Ee9I3m4genc'
        chat_id: 5377484616
        parse_mode: HTML
        message: |
          ğŸ”¥ğŸ”¥ğŸ”¥ <b>CRITICAL ALERT</b> ğŸ”¥ğŸ”¥ğŸ”¥
          ğŸ“¢ {{ .CommonLabels.alertname }}
          ğŸ§¾ {{ .Annotations.summary }}
          ğŸ“¦ Instance: {{ .CommonLabels.instance }}
          ğŸš¨ Status: {{ .Status }}

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
